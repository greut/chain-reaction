{% extends "base.html" %}

{% block content %}

<h1>{{ game }}</h1>
{% if game.type == game.GameType.Done %}
  <p>This game is done...</p>
{% else %}
<script>
$(function(){
    var proto = document.location.protocol === 'https:' ? 'wss:' : 'ws:'
    var port = document.location.port === '8000' ? 8001 : document.location.port
    ws = new WebSocket(proto + '//' + location.hostname + ':' + port + '/ws/game/{{ game.id }}')

    ws.onmessage = function(e) {
      var data = JSON.parse(e.data)
      if ("url" in data) {
          window.location = data.url
      }
    }

    ws.onopen = function() {
        ws.send(JSON.stringify({from: {{ user.id }}, action: 'join'}))
    }

    if (ws.readyState == WebSocket.OPEN) {
        ws.onopen();
    }
});
</script>
{% endif %}
{% endblock %}
