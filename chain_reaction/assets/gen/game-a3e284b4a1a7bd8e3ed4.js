!function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=9)}([function(e,t){e.exports=jQuery},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e){var t=(0,f.default)("h2"),n=t.find("b");n[0].innerText=e[0],n[1].innerText=e[1]}function i(){var e=(0,f.default)("#status");m!=l?e.addClass("alert-info").removeClass("alert-success").text("Attente de l'autre joueur..."):e.addClass("alert-success").removeClass("alert-info").text("Ã€ vous de jouer!")}function c(){var e=[0,0];return b.forEach(function(t){t.forEach(function(t){void 0!==t.player&&(e[t.player]+=t.selectedCircles)})}),e}function s(e,t){function n(t,n){O(b[t][n]).then(function(){var t=c();r(t),i(),m!==l&&(console.log("score",t),e.stream("score").send({tick:C,player:l,score:t})),o(t)})}function o(t){return h>=2&&t.indexOf(0)>-1&&(m!==l?alert("You win!"):alert("You lose!"),e.stream("control").send({action:"close",tick:C}),a.off("mouse.down",f),!0)}a=new v.default.Canvas(t[0]),l=t.data("num");var s=!1;e.listen(function(e,t){console.log("*",e,t)}),e.demultiplex("control",function(t,n){console.log("control",t,n),"done"===t.action?"url"in t&&(window.location=t.url):"start"===t.action?(C=t.plays.length?t.plays[t.plays.length-1].turn:0,s||(s=!0,_(t.plays.slice()))):"joined"===t.action?e.stream("control").send({action:"start"}):"info"===t.action&&console.info(t.message)}),e.demultiplex("play",function(e,t){console.log("play",e,t),C=e.tick,e.player!=l&&n(e.x,e.y)});var u=function(){h++,m=0===m?1:0,a.backgroundColor=w[m][0],a.renderAll(!0)},f=function(t){if(a.deactivateAll(),0===l&&0===m||1===l&&1===m){var o;void 0!==t.target&&("rect"===t.target.type?o=t.target:"circle"===t.target.type&&(o=t.target.square),n(o.xposition,o.yposition),e.stream("play").send({tick:++C,player:l,x:o.xposition,y:o.yposition}))}},d=function(e,t){var n=e.selectedCircles;0===e.selectedCircles&&"#e5e5e5"===t&&(n=e.maxCircles);for(var o=0;o<n;o++)e.circles[o].set("fill",t);a.renderAll(!0)},O=function(e){return new Promise(function(t,n){if(e.initialState&&(e.initialState=!1,e.player=m),e.player===m)if(e.selectedCircles+=1,e.selectedCircles<e.maxCircles&&(e.player=m,d(e,w[m][0]),u()),e.selectedCircles===e.maxCircles){var o=[e],r=function e(){var n=o.shift();void 0!==n?(S(n,o),window.setTimeout(e)):(u(),t())};window.setTimeout(r,0)}else t()})},S=function(e,t){e.selectedCircles=0,d(e,"#e5e5e5"),e.initialState=!0;for(var n=0;n<E.length;n++){var o=e.xposition+E[n].x,r=e.yposition+E[n].y;if(!(o<0||r<0||o>p-1||r>p-1)){var i=b[o][r];i.selectedCircles+=1,i.selectedCircles===i.maxCircles?t.push(i):i.selectedCircles<i.maxCircles&&(i.initialState&&(i.initialState=!1),i.player=m,d(i,w[m][0]))}}},T=function(){a.backgroundColor=w[0][0],a.setDimensions({width:p*y+1,height:p*y+1});for(var e=0;e<p;e++){for(var t=[],n=0;n<p;n++){var o=new v.default.Rect(g);o.xposition=e,o.yposition=n,o.initialState=!0,o.maxCircles=0!==e&&e!==p-1||0!==n&&n!==p-1?0===e||0===n||e===p-1||n===p-1?3:4:2,g.left+=y,t.push(o),a.add(o)}b.push(t),g.left=1,g.top+=y}for(var e=0;e<2*p;e++){for(var r,n=0;n<2*p;n++){if(n%2==0){r=b[e%2==0?e/2:(e-1)/2][n/2],void 0===r.circles&&(r.circles=[],r.selectedCircles=0)}var i=new v.default.Circle(x);i.square=r,x.left+=k,r.circles.push(i),a.add(i)}x.left=3,x.top+=k}},j=function(){m=0,h=0,b=[],a.clear(),g.left=1,g.top=1,x.left=4,x.top=4,T(),a.renderAll(!0)},_=function(e){j(),function t(){e.length?O(b[e[0].x][e[0].y]).then(function(){var n=c();r(n),o(n)||(e.shift(),window.setTimeout(t,200))}):(i(),a.on("mouse:down",f))}()}}var a,l,u=n(0),f=o(u),d=n(13),v=o(d),p=8,y=60,m=0,h=0,w=[["red","lightred"],["green","lightgreen"]],g={left:1,top:1,fill:"#e5e5e5",width:y-1,height:y-1,hoverCursor:"pointer",selectable:!0,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,hasControls:!1},x={radius:y/5,fill:"#e5e5e5",left:4,top:4,hoverCursor:"pointer",selectable:!0,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,hasControls:!1,hasBorders:!1},b=[],k=y/2,C=0,E=[{x:-1,y:0},{x:0,y:-1},{x:0,y:1},{x:1,y:0}];e.exports=s},function(e,t,n){"use strict";function o(e){e.listen(function(e,t){console.log("*",e,t)}),e.demultiplex("control",function(t,n){console.log("control",t,n),"url"in t&&(window.location=t.url),"action"in t&&"joined"==t.action&&e.stream("control").send({action:"join"})})}e.exports=o},,function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketBridge=void 0;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=n(12),s=function(e){return e&&e.__esModule?e:{default:e}}(c),a=function(){function e(t){o(this,e),this.socket=null,this.streams={},this.default_cb=null,this.options=r({},t)}return i(e,[{key:"connect",value:function(e,t,n){var o=void 0,r="https:"===window.location.protocol?"wss":"ws",i=r+"://"+window.location.host;o=void 0===e?i:"/"==e[0]?""+i+e:e,this.socket=new s.default(o,t,n)}},{key:"listen",value:function(e){var t=this;this.default_cb=e,this.socket.onmessage=function(e){var n=JSON.parse(e.data),o=void 0,r=void 0;if(void 0!==n.stream){o=n.payload,r=n.stream;var i=t.streams[r];i&&i(o,r)}else o=n,r=null,t.default_cb&&t.default_cb(o,r)}}},{key:"demultiplex",value:function(e,t){this.streams[e]=t}},{key:"send",value:function(e){this.socket.send(JSON.stringify(e))}},{key:"stream",value:function(e){var t=this;return{send:function(n){var o={stream:e,payload:n};t.socket.send(JSON.stringify(o))}}}}]),e}();t.WebSocketBridge=a},function(e,t){},,,,function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}var r=n(0),i=o(r),c=n(4),s=n(2),a=o(s),l=n(1),u=o(l);n(5);(0,i.default)(function(){var e="https:"===document.location.protocol?"wss:":"ws:",t="8000"===document.location.port?8001:document.location.port,n=(0,i.default)("#game"),o=n.data("ws");if(!o)return void console.error("no game found.");var r=new c.WebSocketBridge;r.connect(e+"//"+location.hostname+":"+t+"/ws"+o),void 0===r.socket&&(r.socket=r._socket),"O"==n.data("type")?(0,a.default)(r):(0,u.default)(r,n)})},,,function(e,t,n){"use strict";var o=function(e){return e&&2===e.CLOSING},r=function(){return"undefined"!=typeof WebSocket&&o(WebSocket)},i=function(){return{constructor:r()?WebSocket:null,maxReconnectionDelay:1e4,minReconnectionDelay:1500,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,debug:!1}},c=function(e,t,n){Object.defineProperty(t,n,{get:function(){return e[n]},set:function(t){e[n]=t},enumerable:!0,configurable:!0})},s=function(e){return e.minReconnectionDelay+Math.random()*e.minReconnectionDelay},a=function(e,t){var n=t*e.reconnectionDelayGrowFactor;return n>e.maxReconnectionDelay?e.maxReconnectionDelay:n},l=["onopen","onclose","onmessage","onerror"],u=function(e,t,n){Object.keys(n).forEach(function(t){n[t].forEach(function(n){var o=n[0],r=n[1];e.addEventListener(t,o,r)})}),t&&l.forEach(function(n){e[n]=t[n]})},f=function e(t,n,r){var l=this;void 0===r&&(r={});var f,d,v=0,p=0,y=!0,m=null,h={};if(!(this instanceof e))throw new TypeError("Failed to construct 'ReconnectingWebSocket': Please use the 'new' operator");var w=i();if(Object.keys(w).filter(function(e){return r.hasOwnProperty(e)}).forEach(function(e){return w[e]=r[e]}),!o(w.constructor))throw new TypeError("Invalid WebSocket constructor. Set `options.constructor`");var g=w.debug?function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return console.log.apply(console,["RWS:"].concat(e))}:function(){},x=function(e,t){return setTimeout(function(){var n=new Error(t);n.code=e,Array.isArray(h.error)&&h.error.forEach(function(e){return(0,e[0])(n)}),f.onerror&&f.onerror(n)},0)},b=function(){if(g("close"),p++,g("retries count:",p),p>w.maxRetries)return void x("EHOSTDOWN","Too many failed connection attempts");v=v?a(w,v):s(w),g("reconnectDelay:",v),y&&setTimeout(k,v)},k=function(){g("connect");var e=f;f=new w.constructor(t,n),d=setTimeout(function(){g("timeout"),f.close(),x("ETIMEDOUT","Connection timeout")},w.connectionTimeout),g("bypass properties");for(var o in f)["addEventListener","removeEventListener","close","send"].indexOf(o)<0&&c(f,l,o);f.addEventListener("open",function(){clearTimeout(d),g("open"),v=s(w),g("reconnectDelay:",v),p=0}),f.addEventListener("close",b),u(f,e,h),f.onclose=f.onclose||m,m=null};g("init"),k(),this.close=function(e,t,n){void 0===e&&(e=1e3),void 0===t&&(t="");var o=void 0===n?{}:n,r=o.keepClosed,i=void 0!==r&&r,c=o.fastClose,s=void 0===c||c,a=o.delay,l=void 0===a?0:a;if(l&&(v=l),y=!i,f.close(e,t),s){var u={code:e,reason:t,wasClean:!0};b(),f.removeEventListener("close",b),Array.isArray(h.close)&&h.close.forEach(function(e){var t=e[0],n=e[1];t(u),f.removeEventListener("close",t,n)}),f.onclose&&(m=f.onclose,f.onclose(u),f.onclose=null)}},this.send=function(e){f.send(e)},this.addEventListener=function(e,t,n){Array.isArray(h[e])?h[e].some(function(e){return e[0]===t})||h[e].push([t,n]):h[e]=[[t,n]],f.addEventListener(e,t,n)},this.removeEventListener=function(e,t,n){Array.isArray(h[e])&&(h[e]=h[e].filter(function(e){return e[0]!==t})),f.removeEventListener(e,t,n)}};e.exports=f},function(e,t){e.exports=fabric}]);