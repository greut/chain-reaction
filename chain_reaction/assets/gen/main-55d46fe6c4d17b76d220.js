!function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(e,t){e.exports=jQuery},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=(0,f.default)("h1"),n=t.find("b");n[0].innerText=e[0],n[1].innerText=e[1]}function r(){var e=(0,f.default)("h2");x!=s?e.text("Attente de l'autre joueur..."):e.text("Ã€ vous de jouer!")}function a(){var e=[0,0];return w.forEach(function(t){t.forEach(function(t){"undefined"!=typeof t.player&&(e[t.player]+=t.selectedCircles)})}),e}function l(e,t){c=new p.default.Canvas(t[0]),s=t.data("num");var n=!1;e.onmessage=function(t){var o=JSON.parse(t.data);console.log(o),"done"===o.action?(console.log("game is done"),"url"in o&&(window.location=o.url)):"start"===o.action?(console.log("game is starting"),k=o.plays.length?o.plays[o.plays.length-1].turn:0,n||(n=!0,J(o.plays.slice()))):"play"===o.action&&(k=o.tick,f(w[o.x][o.y],function(){var t=a();if(i(t),r(),x!==s&&e.send(JSON.stringify({tick:k,player:s,action:"score",score:t})),m>=2&&t.indexOf(0)>-1){if(x!==s){alert("You win!");var n={action:"close",tick:k,player:s};e.send(JSON.stringify(n))}else alert("You lose!");c.off("mouse.down",l),e.close()}}))},e.onopen=function(){e.send(JSON.stringify({action:"start"}))};var o=function(){m++,x=0===x?1:0,c.backgroundColor=g[x],c.renderAll(!0)},l=function(t){if(c.deactivateAll(),0===s&&0===x||1===s&&1===x){var n;if("undefined"!=typeof t.target){"rect"===t.target.type?n=t.target:"circle"===t.target.type&&(n=t.target.square);var o={tick:++k,player:s,action:"play",x:n.xposition,y:n.yposition};e.send(JSON.stringify(o))}}},u=function(e,t){var n=e.selectedCircles;0===e.selectedCircles&&"#e5e5e5"===t&&(n=e.maxCircles);for(var o=0;o<n;o++)e.circles[o].set("fill",t),c.renderAll(!0)},f=function(e,t){if(e.initialState&&(e.initialState=!1,e.player=x),e.player===x)if(e.selectedCircles+=1,e.selectedCircles<e.maxCircles&&(e.player=x,u(e,g[x]),o()),e.selectedCircles===e.maxCircles){var n=[e],i=function e(){var i=n.shift();"undefined"!=typeof i?(d(i,n),window.setTimeout(e)):(o(),t&&t())};window.setTimeout(i,0)}else t&&t()},d=function(e,t){e.selectedCircles=0,u(e,"#e5e5e5"),e.initialState=!0;for(var n=0;n<O.length;n++){var o=e.xposition+O[n].x,i=e.yposition+O[n].y;if(!(o<0||i<0||o>v-1||i>v-1)){var r=w[o][i];r.selectedCircles+=1,r.selectedCircles===r.maxCircles?t.push(r):r.selectedCircles<r.maxCircles&&(r.initialState&&(r.initialState=!1),r.player=x,u(r,g[x]))}}},b=function(){c.backgroundColor=g[0],c.setDimensions({width:v*y+1,height:v*y+1});for(var e=0;e<v;e++){for(var t=[],n=0;n<v;n++){var o=new p.default.Rect(h);o.xposition=e,o.yposition=n,o.initialState=!0,0!==e&&e!==v-1||0!==n&&n!==v-1?0===e||0===n||e===v-1||n===v-1?o.maxCircles=3:o.maxCircles=4:o.maxCircles=2,h.left+=y,t.push(o),c.add(o)}w.push(t),h.left=1,h.top+=y}for(var e=0;e<2*v;e++){for(var i,n=0;n<2*v;n++){if(n%2===0){var r=e%2===0?e/2:(e-1)/2;i=w[r][n/2],void 0===i.circles&&(i.circles=[],i.selectedCircles=0)}var a=new p.default.Circle(C);a.square=i,C.left+=S,i.circles.push(a),c.add(a)}C.left=3,C.top+=S}},N=function(){x=0,m=0,w=[],c.clear(),h.left=1,h.top=1,C.left=4,C.top=4,b(),c.renderAll(!0)},J=function(e){function t(){e.length?f(w[e[0].x][e[0].y],function(){i(a()),e.shift(),window.setTimeout(t,200)}):(r(),c.on("mouse:down",l))}N(),window.setTimeout(t,200)}}var c,s,u=n(0),f=o(u),d=n(3),p=o(d),v=8,y=60,x=0,m=0,g=["red","green"],h={left:1,top:1,fill:"#e5e5e5",width:y-1,height:y-1,hoverCursor:"pointer",selectable:!0,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,hasControls:!1},C={radius:y/5,fill:"#e5e5e5",left:4,top:4,hoverCursor:"pointer",selectable:!0,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,hasControls:!1,hasBorders:!1},w=[],S=y/2,k=0,O=[{x:-1,y:0},{x:0,y:-1},{x:0,y:1},{x:1,y:0}];e.exports=l},function(e,t,n){"use strict";function o(e){e.onopen=function(t){e.send(JSON.stringify({action:"join"}))},e.onmessage=function(e){var t=JSON.parse(e.data);"url"in t&&(window.location=t.url)}}e.exports=o},function(e,t){e.exports=fabric},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}var i=n(0),r=o(i),a=n(2),l=o(a),c=n(1),s=o(c),u="O";(0,r.default)(function(){var e="https:"===document.location.protocol?"wss:":"ws:",t="8000"===document.location.port?8001:document.location.port,n=(0,r.default)("#game"),o=n.data("ws");if(!o)return void console.error("no game found.");var i=new WebSocket(e+"//"+location.hostname+":"+t+"/ws"+o);n.data("type")==u?(0,l.default)(i):(0,s.default)(i,n),i.readyState==WebSocket.OPEN&&i.onopen()})}]);