!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=14)}([function(e,t){e.exports=jQuery},function(e,t){e.exports=fabric},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketBridge=void 0;var o,r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=n(7),s=(o=c)&&o.__esModule?o:{default:o};var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.socket=null,this.streams={},this.default_cb=null,this.options=r({},t)}return i(e,[{key:"connect",value:function(e,t,n){var o=void 0,r=("https:"===window.location.protocol?"wss":"ws")+"://"+window.location.host;o=void 0===e?r:"/"==e[0]?""+r+e:e,this.socket=new s.default(o,t,n)}},{key:"listen",value:function(e){var t=this;this.default_cb=e,this.socket.onmessage=function(e){var n=JSON.parse(e.data),o=void 0,r=void 0;if(void 0!==n.stream){o=n.payload,r=n.stream;var i=t.streams[r];i&&i(o,r)}else o=n,r=null,t.default_cb&&t.default_cb(o,r)}}},{key:"demultiplex",value:function(e,t){this.streams[e]=t}},{key:"send",value:function(e){this.socket.send(JSON.stringify(e))}},{key:"stream",value:function(e){var t=this;return{send:function(n){var o={stream:e,payload:n};t.socket.send(JSON.stringify(o))}}}}]),e}();t.WebSocketBridge=a},function(e,t){e.exports=function(e){e.listen(function(e,t){console.log("*",e,t)}),e.demultiplex("control",function(t,n){console.log("control",t,n),"url"in t&&(window.location=t.url),"action"in t&&"joined"==t.action&&e.stream("control").send({action:"join"})})}},,,function(e,t,n){"use strict";var o=function(e){return e&&2===e.CLOSING},r=function(e,t,n){Object.defineProperty(t,n,{get:function(){return e[n]},set:function(t){e[n]=t},enumerable:!0,configurable:!0})},i=function(e){return e.minReconnectionDelay+Math.random()*e.minReconnectionDelay},c=["onopen","onclose","onmessage","onerror"];e.exports=function e(t,n,s){var a,l,u=this;void 0===s&&(s={});var f=0,d=0,v=!0,p=null,y={};if(!(this instanceof e))throw new TypeError("Failed to construct 'ReconnectingWebSocket': Please use the 'new' operator");var m={constructor:"undefined"!=typeof WebSocket&&o(WebSocket)?WebSocket:null,maxReconnectionDelay:1e4,minReconnectionDelay:1500,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,debug:!1};if(Object.keys(m).filter(function(e){return s.hasOwnProperty(e)}).forEach(function(e){return m[e]=s[e]}),!o(m.constructor))throw new TypeError("Invalid WebSocket constructor. Set `options.constructor`");var h=m.debug?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return console.log.apply(console,["RWS:"].concat(e))}:function(){},g=function(e,t){return setTimeout(function(){var n=new Error(t);n.code=e,Array.isArray(y.error)&&y.error.forEach(function(e){return(0,e[0])(n)}),a.onerror&&a.onerror(n)},0)},b=function(){h("handleClose",{shouldRetry:v}),h("retries count:",++d),d>m.maxRetries?g("EHOSTDOWN","Too many failed connection attempts"):(f=f?function(e,t){var n=t*e.reconnectionDelayGrowFactor;return n>e.maxReconnectionDelay?e.maxReconnectionDelay:n}(m,f):i(m),h("handleClose - reconnectDelay:",f),v&&setTimeout(w,f))},w=function(){if(v){h("connect");var e=a,o="function"==typeof t?t():t;for(var s in a=new m.constructor(o,n),l=setTimeout(function(){h("timeout"),a.close(),g("ETIMEDOUT","Connection timeout")},m.connectionTimeout),h("bypass properties"),a)["addEventListener","removeEventListener","close","send"].indexOf(s)<0&&r(a,u,s);a.addEventListener("open",function(){clearTimeout(l),h("open"),f=i(m),h("reconnectDelay:",f),d=0}),a.addEventListener("close",b),function(e,t,n){Object.keys(n).forEach(function(t){n[t].forEach(function(n){var o=n[0],r=n[1];e.addEventListener(t,o,r)})}),t&&c.forEach(function(n){e[n]=t[n]})}(a,e,y),a.onclose=a.onclose||p,p=null}};h("init"),w(),this.close=function(e,t,n){void 0===e&&(e=1e3),void 0===t&&(t="");var o=void 0===n?{}:n,r=o.keepClosed,i=void 0!==r&&r,c=o.fastClose,s=void 0===c||c,l=o.delay,u=void 0===l?0:l;if(h("close - params:",{reason:t,keepClosed:i,fastClose:s,delay:u,retriesCount:d,maxRetries:m.maxRetries}),v=!i&&d<=m.maxRetries,u&&(f=u),a.close(e,t),s){var g={code:e,reason:t,wasClean:!0};b(),a.removeEventListener("close",b),Array.isArray(y.close)&&y.close.forEach(function(e){var t=e[0],n=e[1];t(g),a.removeEventListener("close",t,n)}),a.onclose&&(p=a.onclose,a.onclose(g),a.onclose=null)}},this.send=function(e){a.send(e)},this.addEventListener=function(e,t,n){Array.isArray(y[e])?y[e].some(function(e){return e[0]===t})||y[e].push([t,n]):y[e]=[[t,n]],a.addEventListener(e,t,n)},this.removeEventListener=function(e,t,n){Array.isArray(y[e])&&(y[e]=y[e].filter(function(e){return e[0]!==t})),a.removeEventListener(e,t,n)}}},function(e,t,n){},,,,,,function(e,t,n){"use strict";n.r(t);var o,r,i=n(0),c=n.n(i),s=n(3),a=n(4),l=n.n(a),u=n(1),f=n.n(u),d=8,v=60,p=0,y=0,m=[["red","lightred"],["green","lightgreen"]],h={left:1,top:1,fill:"#e5e5e5",width:v-1,height:v-1,hoverCursor:"pointer",selectable:!0,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,hasControls:!1},g={radius:v/5,fill:"#e5e5e5",left:4,top:4,hoverCursor:"pointer",selectable:!0,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,hasControls:!1,hasBorders:!1},b=[],w=v/2,x=0,C=[{x:-1,y:0},{x:0,y:-1},{x:0,y:1},{x:1,y:0}];function k(e){var t=c()("h2").find("b");t[0].innerText=e[0],t[1].innerText=e[1]}function E(){var e=c()("#status");p!=r?e.addClass("alert-info").removeClass("alert-success").text("Attente de l'autre joueur..."):e.addClass("alert-success").removeClass("alert-info").text("Ã€ vous de jouer!")}function O(){var e=[0,0];return b.forEach(function(t){t.forEach(function(t){void 0!==t.player&&(e[t.player]+=t.selectedCircles)})}),e}function S(e,t){o=new f.a.Canvas(t[0]),r=t.data("num");var n=!1;function i(t,n){u(b[t][n]).then(function(){var t=O();k(t),E(),p!==r&&(console.log("score",t),e.stream("score").send({tick:x,player:r,score:t})),c(t)})}function c(t){return y>=2&&t.indexOf(0)>-1&&(p!==r?alert("You win!"):alert("You lose!"),e.stream("control").send({action:"close",tick:x}),o.off("mouse.down",a),!0)}e.listen(function(e,t){console.log("*",e,t)}),e.demultiplex("control",function(t,o){console.log("control",t,o),"done"===t.action?"url"in t&&(window.location=t.url):"start"===t.action?(x=t.plays.length?t.plays[t.plays.length-1].turn:0,n||(n=!0,T(t.plays.slice()))):"joined"===t.action?e.stream("control").send({action:"start"}):"info"===t.action&&console.info(t.message)}),e.demultiplex("play",function(e,t){console.log("play",e,t),x=e.tick,e.player!=r&&i(e.x,e.y)});var s=function(){y++,p=0===p?1:0,o.backgroundColor=m[p][0],o.renderAll(!0)},a=function(t){var n;(o.deactivateAll(),0===r&&0===p||1===r&&1===p)&&(void 0!==t.target&&("rect"===t.target.type?n=t.target:"circle"===t.target.type&&(n=t.target.square),i(n.xposition,n.yposition),e.stream("play").send({tick:++x,player:r,x:n.xposition,y:n.yposition})))},l=function(e,t){var n=e.selectedCircles;0===e.selectedCircles&&"#e5e5e5"===t&&(n=e.maxCircles);for(var r=0;r<n;r++)e.circles[r].set("fill",t);o.renderAll(!0)},u=function(e){return new Promise(function(t,n){if(e.initialState&&(e.initialState=!1,e.player=p),e.player===p)if(e.selectedCircles+=1,e.selectedCircles<e.maxCircles&&(e.player=p,l(e,m[p][0]),s()),e.selectedCircles===e.maxCircles){var o=[e];window.setTimeout(function e(){var n=o.shift();void 0!==n?(S(n,o),window.setTimeout(e)):(s(),t())},0)}else t()})},S=function(e,t){e.selectedCircles=0,l(e,"#e5e5e5"),e.initialState=!0;for(var n=0;n<C.length;n++){var o=e.xposition+C[n].x,r=e.yposition+C[n].y;if(!(o<0||r<0||o>d-1||r>d-1)){var i=b[o][r];i.selectedCircles+=1,i.selectedCircles===i.maxCircles?t.push(i):i.selectedCircles<i.maxCircles&&(i.initialState&&(i.initialState=!1),i.player=p,l(i,m[p][0]))}}},j=function(){p=0,y=0,b=[],o.clear(),h.left=1,h.top=1,g.left=4,g.top=4,function(){o.backgroundColor=m[0][0],o.setDimensions({width:d*v+1,height:d*v+1});for(var e=0;e<d;e++){for(var t=[],n=0;n<d;n++){var r=new f.a.Rect(h);r.xposition=e,r.yposition=n,r.initialState=!0,r.maxCircles=0!==e&&e!==d-1||0!==n&&n!==d-1?0===e||0===n||e===d-1||n===d-1?3:4:2,h.left+=v,t.push(r),o.add(r)}b.push(t),h.left=1,h.top+=v}for(e=0;e<2*d;e++){var i;for(n=0;n<2*d;n++){n%2==0&&void 0===(i=b[e%2==0?e/2:(e-1)/2][n/2]).circles&&(i.circles=[],i.selectedCircles=0);var c=new f.a.Circle(g);c.square=i,g.left+=w,i.circles.push(c),o.add(c)}g.left=3,g.top+=w}}(),o.renderAll(!0)},T=function(e){j(),function t(){e.length?u(b[e[0].x][e[0].y]).then(function(){var n=O();k(n),c(n)||(e.shift(),window.setTimeout(t,200))}):(E(),o.on("mouse:down",a))}()}}n(8);c()(function(){var e="https:"===document.location.protocol?"wss:":"ws:",t="8000"===document.location.port?8001:document.location.port,n=c()("#game"),o=n.data("ws");if(o){var r=new s.WebSocketBridge;r.connect(e+"//"+location.hostname+":"+t+"/ws"+o),void 0===r.socket&&(r.socket=r._socket),"O"==n.data("type")?l()(r):S(r,n)}else console.error("no game found.")})}]);